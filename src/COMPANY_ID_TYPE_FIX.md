# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö company_id –≤ —Ç–∞–±–ª–∏—Ü–µ users

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –†–∞–∑–ª–∏—á–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

**–¢–∞–±–ª–∏—Ü–∞ `users`:**
- `company_id`: **TEXT** (—Å—Ç—Ä–æ–∫–∞)

**–¢–∞–±–ª–∏—Ü–∞ `products`:**
- `company_id`: **INTEGER** (—á–∏—Å–ª–æ)
- `barcode`: **NUMERIC –∏–ª–∏ TEXT** (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ö–µ–º—ã –ë–î)
- `barid`: **NUMERIC –∏–ª–∏ TEXT** (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ö–µ–º—ã –ë–î)

**–ü–æ—á–µ–º—É —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã?**
- –í `users`: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º ID –∫–æ–º–ø–∞–Ω–∏–∏ (—Å—Ç—Ä–æ–∫–∞)
- –í `products`: —Ç–æ–≤–∞—Ä—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–º–ø–∞–Ω–∏—è–º –ø–æ —á–∏—Å–ª–æ–≤–æ–º—É ID

> üìù –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ `products` —Å–º.:
> - `/PRODUCTS_COMPANY_ID_FIX.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ company_id
> - `/BARCODE_BARID_FIX.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ barcode –∏ barid (–æ—à–∏–±–∫–∞ PostgreSQL 22P02)

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª–µ `company_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –≤ Supabase –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ **TEXT**, –∞ –Ω–µ **NUMERIC**. –ö–æ–¥ –ø—ã—Ç–∞–ª—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –∫–∞–∫ —Å —á–∏—Å–ª–æ–º, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É PostgreSQL 22P02 (invalid input syntax for type numeric).

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (`/supabase/functions/server/index.tsx`)

#### Endpoint: POST `/users` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ë—ã–ª–æ:**
```typescript
// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ company_id –≤ —á–∏—Å–ª–æ
if (company_id && typeof company_id === 'string') {
  company_id = parseInt(company_id);
}
```

**–°—Ç–∞–ª–æ:**
```typescript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ company_id –∫–∞–∫ TEXT –ø–æ–ª—è
let companyIdForDb: string | null = null;
if (company_id !== undefined && company_id !== null && company_id !== '') {
  companyIdForDb = company_id.toString();
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `company_id` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `users` –∫–∞–∫ **—Å—Ç—Ä–æ–∫–∞**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `company_id` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `users` –∫–∞–∫ **—Å—Ç—Ä–æ–∫–∞**
- –£–±—Ä–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ KV store –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `company_id` - —Ç–µ–ø–µ—Ä—å –æ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `users`

#### Endpoint: GET `/users/:phone` (–ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ë—ã–ª–æ:**
```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ company_id –∏–∑ KV store
const savedCompanyId = await kv.get(`user_company:${phone}`);
return {
  ...user,
  company_id: savedCompanyId ? parseInt(savedCompanyId) : null
};
```

**–°—Ç–∞–ª–æ:**
```typescript
// company_id —É–∂–µ –µ—Å—Ç—å –≤ user –∏–∑ —Ç–∞–±–ª–∏—Ü—ã (—ç—Ç–æ TEXT –ø–æ–ª–µ)
return {
  user: user
};
```

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (`/components/HomePage.tsx`)

**–ë—ã–ª–æ:**
```typescript
if (userCompanyId) {
  params.companyId = parseInt(userCompanyId);
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (userCompanyId) {
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º company_id (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–∑ –ë–î) –≤ —á–∏—Å–ª–æ –¥–ª—è API
  const companyIdNum = typeof userCompanyId === 'string' ? parseInt(userCompanyId) : userCompanyId;
  if (!isNaN(companyIdNum)) {
    params.companyId = companyIdNum;
  }
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø–µ—Ä–µ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ `parseInt` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `NaN`)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

### 3. API —Ñ—É–Ω–∫—Ü–∏–∏ (`/utils/api.tsx`)

–¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `company_id` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `addUser` —É–∂–µ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º:
```typescript
export async function addUser(user: { 
  first_name: string; 
  last_name: string; 
  phone_number: string; 
  company_id?: string | null  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø!
})
```

## –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users` –≤ Supabase
```
- id: INTEGER (PRIMARY KEY)
- first_name: TEXT
- last_name: TEXT
- phone_number: TEXT (UNIQUE)
- company_id: TEXT (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
- registered_date: TIMESTAMP
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

1. **–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä**: `company_id` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ null
2. **–°–µ—Ä–≤–µ—Ä ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `company_id` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ TEXT
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –°–µ—Ä–≤–µ—Ä**: `company_id` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ TEXT
4. **–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç**: `company_id` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ TEXT (–∏–ª–∏ null)
5. **–ö–ª–∏–µ–Ω—Ç ‚Üí API –∑–∞–ø—Ä–æ—Å—ã**: `company_id` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —á–∏—Å–ª–æ –¥–ª—è endpoint'–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ `company_id` –±—ã–ª —á–∏—Å–ª–æ–º –≤ KV store) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ, —Ç–∞–∫ –∏ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- API endpoint'—ã —Ç–æ–≤–∞—Ä–æ–≤ –æ–∂–∏–¥–∞—é—Ç `company_id` –∫–∞–∫ —á–∏—Å–ª–æ, –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `NaN` –ø–æ—Å–ª–µ `parseInt`
- –û—á–∏—Å—Ç–∫–∞: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏ undefined –≤ null
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ `company_id`)
2. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å `company_id`)
3. ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
6. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ä–µ–∂–∏–º–µ

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- `/COMPANY_ID_UPDATE_FIX.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "company_id cannot be null" –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `/BARCODE_BARID_FIX.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ PostgreSQL 22P02 –¥–ª—è barcode –∏ barid
- `/PRODUCTS_COMPANY_ID_FIX.md` - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ company_id –≤ products