# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ PostgreSQL 22P02 –¥–ª—è barcode –∏ barid

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ PostgreSQL:
```
Error updating product: {
  code: "22P02",
  details: null,
  hint: null,
  message: 'invalid input syntax for type numeric: ""'
}
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

–ü–æ–ª—è `barcode` –∏ `barid` –≤ —Ç–∞–±–ª–∏—Ü–µ `products` –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ç–∏–ø **NUMERIC** –≤ PostgreSQL. –ö–æ–≥–¥–∞ –∫–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å **–ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `""`** –≤ —á–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ, PostgreSQL –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É 22P02.

### –ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:

–í –∫–æ–¥–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç, –≥–¥–µ `barcode` –∏ `barid` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ **–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞**:

```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ù–´–ï –ú–ï–°–¢–ê:
setNewProduct({ 
  name: '', 
  quantity: 0, 
  price: 0, 
  barcode: '', // <-- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
  barid: ''    // <-- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
})

editForm = { 
  name: '', 
  barcode: '', // <-- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
  barid: ''    // <-- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
}
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `barcode` –∏ `barid` –≤ —Å–ø–∏—Å–æ–∫ **numericFields** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

### 1Ô∏è‚É£ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (`/utils/api.tsx`)

```typescript
export async function updateProduct(id: number, updates: any) {
  // üßπ –û—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –≤ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª—è—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  const cleanedUpdates = { ...updates };
  
  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω—ã barcode –∏ barid
  const numericFields = [
    'price', 
    'markup_percent', 
    'markup_amount', 
    'selling_price', 
    'quantity', 
    'company_id',  // INTEGER
    'barcode',     // NUMERIC –∏–ª–∏ TEXT
    'barid'        // NUMERIC –∏–ª–∏ TEXT
  ];
  
  numericFields.forEach(field => {
    if (cleanedUpdates[field] === '' || cleanedUpdates[field] === null || cleanedUpdates[field] === undefined) {
      // ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ "" –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å null!
      cleanedUpdates[field] = null;
    } else if (typeof cleanedUpdates[field] === 'string' && numericFields.includes(field)) {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —á–∏—Å–ª–∞
      const parsed = parseFloat(cleanedUpdates[field]);
      // ‚úÖ –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - —Å—Ç–∞–≤–∏–º null
      cleanedUpdates[field] = isNaN(parsed) ? null : parsed;
    }
  });
  
  await apiCall(`/products/${id}`, {
    method: 'PUT',
    body: JSON.stringify(cleanedUpdates),
  });
}
```

### 2Ô∏è‚É£ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (`/supabase/functions/server/index.tsx`)

```typescript
// Update product
app.put("/make-server-6a74b22c/products/:id", async (c) => {
  try {
    const id = c.req.param('id');
    const body = await c.req.json();
    
    // üßπ –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –≤ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª—è—Ö - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º "" –≤ null
    // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: barcode –∏ barid —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å NUMERIC –∏ —Ç—Ä–µ–±—É—é—Ç –æ—á–∏—Å—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
    const numericFields = [
      'price', 
      'markup_percent', 
      'markup_amount', 
      'selling_price', 
      'quantity', 
      'company_id',  // INTEGER
      'barcode',     // NUMERIC –∏–ª–∏ TEXT
      'barid'        // NUMERIC –∏–ª–∏ TEXT
    ];
    
    numericFields.forEach(field => {
      if (body[field] === '' || body[field] === null || body[field] === undefined) {
        // ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ "" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å null, –Ω–µ ""!
        body[field] = null;
      } else if (typeof body[field] === 'string' && numericFields.includes(field)) {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —á–∏—Å–ª–∞
        const parsed = parseFloat(body[field]);
        // ‚úÖ –í–ê–ñ–ù–û: –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å - —Å—Ç–∞–≤–∏–º null –≤–º–µ—Å—Ç–æ NaN
        body[field] = isNaN(parsed) ? null : parsed;
      }
    });
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  } catch (error) {
    console.error("Error updating product:", error);
    return c.json({ success: false, error: formatError(error) }, 500);
  }
});
```

## üìã –õ–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ      ‚Üí  –û—á–∏—Å—Ç–∫–∞            ‚Üí  –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ë–î
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
barcode: ""         ‚Üí  –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞      ‚Üí  null (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è NUMERIC –∏ TEXT)
barcode: "123"      ‚Üí  –ü–∞—Ä—Å–∏–Ω–≥ –≤ —á–∏—Å–ª–æ    ‚Üí  123 (–¥–ª—è NUMERIC)
barcode: "abc"      ‚Üí  –ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è  ‚Üí  null (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è NUMERIC)
barcode: null       ‚Üí  Null               ‚Üí  null (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è NUMERIC –∏ TEXT)
barcode: undefined  ‚Üí  Undefined          ‚Üí  null (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è NUMERIC –∏ TEXT)
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–æ–π —Ç–∏–ø –∏–º–µ–µ—Ç –ø–æ–ª–µ –≤ –ë–î (NUMERIC –∏–ª–∏ TEXT)
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: `null` –¥–æ–ø—É—Å—Ç–∏–º –∏ –¥–ª—è NUMERIC, –∏ –¥–ª—è TEXT –ø–æ–ª–µ–π
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ PostgreSQL 22P02
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ PostgreSQL 22P02
- ‚úÖ Bulk –∏–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ PostgreSQL 22P02
- ‚úÖ –ü—É—Å—Ç—ã–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ `null`
- ‚úÖ –ü—É—Å—Ç—ã–µ barid –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ `null`
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥—ã/barid –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —á–∏—Å–ª–∞ (–µ—Å–ª–∏ –ø–æ–ª–µ NUMERIC)
- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥—ã/barid –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `null` (–±–µ–∑–æ–ø–∞—Å–Ω–æ)

## üìù –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:
- `/utils/api.tsx`:
  - ‚úÖ `updateProduct()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `barcode` –∏ `barid` –≤ `numericFields`
  - ‚úÖ `addProduct()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `barcode` –∏ `barid` –≤ `numericFields`
  - ‚úÖ `bulkImportProducts()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `barcode` –∏ `barid` –≤ `numericFields`

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å:
- `/supabase/functions/server/index.tsx`:
  - ‚úÖ `PUT /products/:id` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `barcode` –∏ `barid` –≤ `numericFields`
  - ‚úÖ `POST /products/add` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ `barcode` –∏ `barid` –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
  - ‚úÖ `POST /products/bulk-import` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ `barcode` –∏ `barid` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `/PRODUCTS_COMPANY_ID_FIX.md` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å company_id
- `/COMPANY_ID_TYPE_FIX.md` - –†–∞–∑–ª–∏—á–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ò–ú–ï–ß–ê–ù–ò–ï

### –†–∞–∑–Ω–∏—Ü–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:

| –ü–æ–ª–µ       | –¢–∞–±–ª–∏—Ü–∞ `users` | –¢–∞–±–ª–∏—Ü–∞ `products` |
|------------|-----------------|-------------------|
| company_id | **TEXT** (—Å—Ç—Ä–æ–∫–∞) | **INTEGER** (—á–∏—Å–ª–æ) |
| barcode    | ‚Äî               | **NUMERIC –∏–ª–∏ TEXT** |
| barid      | ‚Äî               | **NUMERIC –∏–ª–∏ TEXT** |

**–í–°–ï–ì–î–ê** –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø –ø–æ–ª—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö!
